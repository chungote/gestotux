BEGIN;
CREATE TABLE IF NOT EXISTS categoria ( id INTEGER(10) PRIMARY KEY AUTO_INCREMENT, nombre VARCHAR(100) NOT NULL,	descripcion VARCHAR(200) NULL );
CREATE TABLE IF NOT EXISTS clientes ( id INTEGER(10) NOT NULL AUTO_INCREMENT,	apellido TINYTEXT NOT NULL, nombre TINYTEXT NOT NULL, 	direccion TEXT,	telefono TINYTEXT, 	PRIMARY KEY ( id ) );
CREATE TABLE IF NOT EXISTS producto ( id INTEGER(10) NOT NULL AUTO_INCREMENT, id_categoria INTEGER(10) NOT NULL,  nombre TINYTEXT NOT NULL, precio_venta DOUBLE(15,4) NOT NULL, descripcion TINYBLOB, marca TINYTEXT, PRIMARY KEY( id ), CONSTRAINT `producto_categoria` FOREIGN KEY ( id_categoria ) REFERENCES categoria( id ) );
CREATE TABLE IF NOT EXISTS recibos ( id INTEGER(10) NOT NULL AUTO_INCREMENT, cliente TEXT NOT NULL, num_mes INTEGER(2), texto TINYBLOB, precio DOUBLE(15,4), fecha_pago DATE, contado BOOL, cuenta_corriente BOOL, PRIMARY KEY ( id ) );
CREATE TABLE IF NOT EXISTS presupuestos(id INTEGER(10) NOT NULL AUTO_INCREMENT,id_cliente INTEGER(10) NULL,destinatario TEXT NULL,fecha DATE NOT NULL,total DOUBLE(15,4),contenido BLOB,PRIMARY KEY( id ));
CREATE TABLE IF NOT EXISTS presupuestos_productos(id INTEGER(10) NOT NULL AUTO_INCREMENT,id_presupuesto INTEGER(10) NOT NULL,id_producto INTEGER(10) NOT NULL,cantidad INTEGER(10),PRIMARY KEY( id ),CONSTRAINT `presupuesto_relacion_presupuesto` FOREIGN KEY ( id_presupuesto )  REFERENCES presupuestos(id),CONSTRAINT `presupuesto_relacion_producto` FOREIGN KEY ( id_producto ) REFERENCES productos(id));
CREATE TABLE IF NOT EXISTS car_categorias(id_categoria INTEGER(10) NOT NULL AUTO_INCREMENT,nombre TEXT NOT NULL,especial BOOL NULL DEFAULT FALSE,PRIMARY KEY ( id_categoria ));
CREATE TABLE IF NOT EXISTS car_establecimientos(id_establecimiento INTEGER(10) NOT NULL AUTO_INCREMENT,nombre TEXT NOT NULL,respma TEXT NOT NULL,PRIMARY KEY ( id_establecimiento ));
CREATE TABLE IF NOT EXISTS car_caravana(id_caravana INTEGER(10) NOT NULL AUTO_INCREMENT,codigo VARCHAR(100) NOT NULL UNIQUE,PRIMARY KEY ( id_caravana ));
CREATE TABLE IF NOT EXISTS car_tri (  id_tri INTEGER(10) NOT NULL AUTO_INCREMENT, dta TEXT NOT NULL, razon SMALLINT(1) NOT NULL, guia TEXT NULL, fecha TEXT NOT NULL, id_categoria INTEGER(10) NOT NULL, id_estab_destino INTEGER(10) NULL, id_estab_origen INTEGER(10) NULL, id_comprador INTEGER(10) NULL, id_vendedor INTEGER(10) NULL, cantidad_caravanas INTEGER(10) DEFAULT 0, PRIMARY KEY ( id_tri ), FOREIGN KEY ( id_categoria ) REFERENCES car_categorias(id_categoria), FOREIGN KEY ( id_estab_destino ) REFERENCES car_establecimientos( id_establecimiento ), FOREIGN KEY ( id_estab_origen ) REFERENCES car_establecimientos( id_establecimiento ), FOREIGN KEY ( id_comprador ) REFERENCES clientes( id ), FOREIGN KEY ( id_vendedor ) REFERENCES clientes( id ) );
CREATE TABLE IF NOT EXISTS car_carv_tri(id_caravana INTEGER(10) NOT NULL,id_tri INTEGER(10) NOT NULL,PRIMARY KEY( id_caravana, id_tri ),FOREIGN KEY ( id_caravana ) REFERENCES car_caravana( id_caravana ),FOREIGN KEY ( id_tri ) REFERENCES car_tri( id_tri ));
CREATE TABLE IF NOT EXISTS car_carv_duenos(id_caravana INTEGER(10) NOT NULL,id_cliente INTEGER(10),fecha_inicio DATE NOT NULL,fecha_fin DATE NULL,PRIMARY KEY( id_caravana, id_cliente ),FOREIGN KEY ( id_caravana ) REFERENCES car_caravana( id_caravana ),FOREIGN KEY ( id_cliente ) REFERENCES clientes( id ));