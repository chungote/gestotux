<?php

/*
-- Estructura de tabla para la tabla `noticias_noticias`

CREATE TABLE IF NOT EXISTS `noticias_noticias` (
  `id_noticia` int(11) NOT NULL auto_increment,
  `titulo` text collate latin1_spanish_ci NOT NULL,
  `subtitulo` text collate latin1_spanish_ci NOT NULL,
  `resumen` tinyblob NOT NULL,
  `textocompleto` longblob NOT NULL,
  `fecha_publicado` datetime NOT NULL,
  PRIMARY KEY  (`id_noticia`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1 COLLATE=latin1_spanish_ci AUTO_INCREMENT=1 ;
*/

class Noticias {
	
  var $nombre_tabla = "noticias_noticias";
  var $nombre_tabla_fotos = "noticias_fotos";
  var $nombre_indice = "id_noticia";

  function titularesPaginaInicial() {
     global $db_connection;
     $cola = "SELECT ".$this->nombre_indice.", titulo FROM ".$this->nombre_tabla." ORDER BY fecha_publicado DESC LIMIT 3";
     $resultado = mysql_query( $cola, $db_connection );
     if( $resultado == FALSE ) {
        echo "Error al buscar las noticias";
     }
     unset( $cola );
     $devolucion = array();
     while( $info = mysql_fetch_array( $resultado ) )
     {
      $noticia = array();
      $noticia['id'] = $info['id_noticia'];
      $noticia['titulo'] = $info['titulo'];
      $devolucion[] = $noticia;
     }
     unset( $resultado );
     return $devolucion;
  }

  function noticiaCompleta( $id_noticia = null ) {
	if( $id_noticia == null ) { return false; }
	global $db_connection;
	$cola = "SELECT * FROM ".$this->nombre_tabla." WHERE ". $this->nombre_indice." = " . $id_noticia;
	$resultado = mysql_query( $cola, $db_connection );
	if( $resultado == FALSE ) { unset( $resultado ); unset( $cola ); return false; }
	unset( $cola );
	$not = mysql_fetch_object( $resultado );
	unset( $resultado );
	$cola = "SELECT id_foto, ruta, titulo, minitura FROM ".$this->nombre_tabla_fotos." WHERE noticia_id = ".$id_noticia. " ORDER BY publicado";
	$resultado = mysql_query( $cola, $db_connection );
	if( $resultado == FALSE )
	{ $not->fotos = array(); }
	else 
	{ 
	 $cond = true;
	 while( $cond ) {
		$res = mysql_fetch_array( $resultado, MYSQL_ASSOC );
		if( $res == FALSE ) { $cond = false; } 
		else {
			//print_r( $res);
			$not->fotos[] = $res;
		}
          }
        }
	unset( $resultado ); unset( $cola );
	return $not;
  }

}
?>